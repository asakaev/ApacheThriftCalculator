var thrift = require('../bin/index.js');
var Idl = require('./idl.js');
var http = require('http');

var idl = new Idl();
var protocol = new thrift.protocol.Json(idl);

var str1 = new Idl.TestStructure(123456789, 'IA_STRINGA', true);
var str2 = new Idl.TestStructure(987654321, 'STRINGA_IA', false);
var testStruct = new Idl.TestStructure2([str1, str2], {
  '1k': 'sd',
  '2k': "as"
});

var message = thrift.encodeCall(protocol, 1, 'uselessMethod', [testStruct]);
var parser = new thrift.Parser(protocol);
console.log(require('util').inspect(parser.process(message), {depth:5}));

//var req = http.request({
//  hostname: '127.0.0.1',
//  port: 10020,
//  method: 'POST',
//  headers: {
//    "content-length": message.length
//  }
//});
//
//req.write(message);
//
//
//req.end();